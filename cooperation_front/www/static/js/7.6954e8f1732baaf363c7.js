webpackJsonp([7],{"lbF+":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("Xxa5"),a=n.n(s),i=n("exGp"),r=n.n(i),o=n("TVmP"),l=n("iyCB"),c=n.n(l),f=n("Ui/T"),u=n("DZOf"),d={components:{Footer:o.a},data:function(){return{tid:this.$route.params.tid,test_1:c.a,search:"",activeName:"今日未完成",score:["10","10"],task_time:{whole:60,current:15},checked:!1,count:0,taskInfo:{},user:{},current:"",diff:0,uid:"",friend_uid:"",button_name:"确认对方已完成",myfinish:"宁今日尚未完成"}},methods:{handleClick:function(t){console.log(t.name)},getTask:function(){var t=this;return r()(a.a.mark(function e(){var n,s,i,r,o,l,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)();case 2:if(0==(n=e.sent).code){e.next=8;break}alert("宁没有登录"),t.$router.push({path:"/"}),e.next=19;break;case 8:return t.user=n.data,e.next=11,Object(u.b)("/api/task/find",{filter:{_id:t.tid}});case 11:s=e.sent,t.taskInfo=s.data[0],n._id==t.taskInfo.uid1?(t.uid="uid1",t.friend_uid="uid2"):(t.uid="uid2",t.friend_uid="uid1"),i=new Date,r=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),o=t.dateDiff(r,t.taskInfo.start),l=t.taskInfo.days,o<0?(t.current="还有"+Math.abs(o)+"天开始",t.diff=1,t.button_name="尚未开始"):o>=l?(t.current="已结束",t.diff=l-1,t.button_name="已结束"):(t.current=o+1,t.diff=o+1,0!=(c=t.taskInfo.finish)[t.friend_uid][o-1]&&(t.button_name="对方已完成"),0!=c[t.uid][o-1]&&(t.myfinish="宁已完成"));case 19:case"end":return e.stop()}},e,t)}))()},dateDiff:function(t,e){var n,s,a=void 0;return a=t.split("-"),n=new Date(a[1]+"-"+a[2]+"-"+a[0]),a=e.split("-"),s=new Date(a[1]+"-"+a[2]+"-"+a[0]),parseInt((n-s)/1e3/60/60/24)},confirmFinish:function(){var t=this;"确认对方已完成"==this.button_name?(this.taskInfo.finish[this.friend_uid][this.diff-1]=1,this.taskInfo[this.friend_uid]+=5,Object(u.b)("/api/task/"+this.taskInfo._id+"/update",this.taskInfo).then(function(e){console.log(e),t.button_name="对方已完成"})):this.$message({message:"当前不可进行此操作！",type:"warning"})}},mounted:function(){this.getTask()}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-container",[n("el-header",{staticStyle:{height:"250px"}},[n("el-row",{staticStyle:{display:"flex","align-items":"center"}},[n("el-col",{attrs:{span:3}},[n("router-link",{attrs:{to:"/task"}},[n("i",{staticClass:"el-icon-arrow-left",staticStyle:{"font-size":"25px",color:"#B8CDE6"}})])],1),t._v(" "),n("el-col",{attrs:{span:20}},[n("h1",[t._v(t._s(t.taskInfo.desc))])])],1),t._v(" "),n("el-row",[n("el-image",{staticStyle:{height:"180px"},attrs:{src:t.test_1}})],1)],1),t._v(" "),n("el-main",[n("div",{staticClass:"big-box"},[n("el-row",{staticStyle:{"text-align":"left"}},[n("el-col",{attrs:{span:12,offset:1}},[n("p",[t._v("我的累计积分:"+t._s(t.taskInfo.score[t.uid]))])]),t._v(" "),n("el-col",{attrs:{span:10}},[n("p",[t._v("每日完成得分: 5")])])],1),t._v(" "),n("el-row",{staticClass:"row-text-left"},[n("el-col",{attrs:{span:12,offset:1}},[n("p",[t._v("当前:"+t._s(t.current))])]),t._v(" "),n("el-col",{attrs:{span:10}},[n("p",[t._v("总时间:"+t._s(t.taskInfo.days)+"天")])])],1)],1),t._v(" "),n("div",{staticStyle:{margin:"30px"}},[n("h3",{staticStyle:{margin:"2px"}},[t._v("第"+t._s(t.diff)+"日安排")]),t._v(" "),t._l(t.taskInfo.tasks[t.diff-1],function(e,s){return n("div",{key:s},[n("el-row",{staticClass:"row-text-left"},[n("h4",{staticStyle:{margin:"5px"}},[t._v(t._s(s))])]),t._v(" "),n("el-row",{staticClass:"row-text-left"},[n("el-col",{attrs:{offset:1}},[t._v("\n            "+t._s(e)+"\n          ")])],1)],1)}),t._v(" "),n("el-button",{staticStyle:{"background-color":"#B8CDE6"},on:{click:t.confirmFinish}},[t._v(t._s(t.button_name))]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("el-row",{staticStyle:{"font-size":"13px"}},[n("el-col",{attrs:{span:10}},[n("router-link",{staticClass:"route-link",attrs:{to:{name:"plandetail",params:{pid:t.taskInfo.pid}}}},[t._v("\n            关于此计划\n          ")])],1),t._v(" "),n("el-col",{attrs:{span:12,offset:2}},[t._v("\n          "+t._s(t.myfinish)+"\n        ")])],1)],2)]),t._v(" "),n("Footer")],1)},staticRenderFns:[]};var p=n("VU/8")(d,_,!1,function(t){n("wgO/")},null,null);e.default=p.exports},"wgO/":function(t,e){}});
//# sourceMappingURL=7.6954e8f1732baaf363c7.js.map